# delegation-patterns (스킬)

정민(디렉터)이 서브에이전트(직원)들에게 작업을 **효율적으로 위임하고**, 결과를 **일관되게 회수·검증**하기 위한 실행 패턴 모음.

---

## 0) 이 스킬의 전제

- 디렉터(메인 에이전트)는 **요구사항 정의/우선순위/최종 품질 책임**을 가진다.
- 서브에이전트는 **명확히 잘린 작업 단위**(산출물/검증 기준/제약 포함)를 수행한다.
- 병렬 위임은 강력하지만, **컨텍스트 누락과 중복 작업**이 자주 발생한다. → 스폰 전에 “입력/출력/검증 기준”을 먼저 고정한다.

---

## 1) 위임 원칙

### 1.1 작업 유형별 적합한 에이전트 매칭

아래는 “누구에게 무엇을 맡길지”를 빠르게 결정하기 위한 기준이다.

- **코딩/구현(정확성·일관성 중시)**
  - 적합: 코딩 특화(리포지토리 탐색/파일 편집/빌드·테스트 수행에 익숙한) 에이전트
  - 산출물: PR/patch, 변경 파일 목록, 실행 방법, 테스트 결과

- **리서치/분석(정보 탐색·요약·의사결정 지원)**
  - 적합: 자료 수집/비교/정리 능력이 좋은 에이전트
  - 산출물: 근거 링크, 비교표(장단점), 결론 + 불확실성/가정

- **문서화(정리·표준화·템플릿화)**
  - 적합: 문장력/정보 구조화가 좋은 에이전트
  - 산출물: 마크다운 문서, 목차/규칙/예시 포함

- **테스트/QA(재현·검증·체크리스트 수행)**
  - 적합: 절차적 검증, 케이스 설계, 재현성 있는 로그 작성에 강한 에이전트
  - 산출물: 테스트 케이스, 재현 절차, 결과(통과/실패), 로그/스크린샷 경로

- **운영/자동화(스크립트·파이프라인·관측)**
  - 적합: CLI/스크립팅/로그 해석에 강한 에이전트
  - 산출물: 스크립트, 실행/롤백 방법, 안전장치

> 원칙: **작업을 “역할”로 쪼개라.** “A가 전체를 다”보다 “코딩/리서치/문서/테스트”로 쪼개 병렬화가 성과가 좋다.

---

### 1.2 모델 선택 기준 (Kimi K2.5 / Gemini Pro / Gemini Flash)

> 모델은 “정확성 vs 속도 vs 비용”의 트레이드오프다. 아래는 실무용 휴리스틱.

- **Kimi K2.5**
  - 강점: 긴 컨텍스트 처리, 복잡한 추론/기획/설계, 다단계 문제 분해
  - 추천 작업: 아키텍처/설계 리뷰, 난해한 디버깅 가설 수립, 복잡한 문서 구조화
  - 주의: 결과가 길어질 수 있으니 **산출물 형식**을 엄격히 지정

- **Gemini Pro**
  - 강점: 균형형(추론+작성+요약), 비교/정리, 문서 작성 품질
  - 추천 작업: 리서치 요약, 기술 비교, 사용자 문서/가이드 작성, 요구사항 정제
  - 주의: “결론 + 근거 + 한계” 포맷으로 요청해 환각 리스크를 낮춘다

- **Gemini Flash**
  - 강점: 매우 빠름, 초안/브레인스토밍, 간단한 변환 작업
  - 추천 작업: 초안 생성, 규칙 기반 변환, 짧은 요약, 체크리스트/템플릿 생성
  - 주의: 중요한 결정/정확성 요구 작업에는 단독 사용 금지 → Pro/Kimi로 2차 검증

**선택 요령(빠른 규칙)**
- “실패하면 큰 손해” = Kimi K2.5 또는 Pro
- “초안/속도” = Flash
- “근거가 필요한 리서치” = Pro(필요 시 Kimi로 최종 논리 정합성 확인)

---

### 1.3 OpenCode 활용 시점

OpenCode(코딩 에이전트/IDE형 워크플로)를 **‘파일/테스트/리포지토리 탐색’이 포함**되는 작업에서 우선 고려한다.

- 사용 권장
  - 코드베이스 탐색 → 수정 → 빌드/테스트 → 결과 로그 첨부까지 한 번에 필요
  - 다수 파일 편집/리팩토링/의존성 파악이 필요한 작업
  - “정확히 이 파일에 이 변경”이 필요한 작업

- 사용 비권장
  - 순수 리서치/요약/정책 문서 같은 텍스트 작업(브라우저/검색만으로 충분)
  - 요구사항이 아직 모호해서 “바로 코딩”하면 되려 재작업이 커지는 경우

> 원칙: **요구사항이 고정되지 않았으면 OpenCode보다 ‘리서치/정의’ 위임부터.**

---

## 2) sessions_spawn 사용법

> 목표: 서브에이전트가 “재질문 없이” 실행 가능한 수준의 지시문(task)를 작성한다.

### 2.1 기본 구조

필수 요소는 5가지:

1) **목적(Why)**: 무엇을 위해 하는가
2) **범위(Scope)**: 무엇을 포함/제외하는가
3) **입력(Input)**: 참고 자료/파일/링크/현재 상태
4) **산출물(Output)**: 결과물 형태(파일 경로, 섹션, 포맷)
5) **검증(Definition of Done)**: 완료 기준, 테스트/체크리스트

권장 보조 요소:
- 제약(Constraints): 시간/도구/금지사항
- 커뮤니케이션: 질문 허용 범위(가능하면 “질문 대신 가정 명시”)

---

### 2.2 task 작성 요령

**(1) 작업을 ‘결과물’ 중심으로 쓴다**
- 나쁜 예: “리서치 좀 해줘.”
- 좋은 예: “A vs B 비교표(성능/가격/리스크/추천 시나리오) + 결론 5줄 + 출처 링크 5개.”

**(2) 컨텍스트를 “짧고 결정적으로” 제공한다**
- 배경 3~7줄 + 현재 상태 + 목표 독자(누가 읽는지) 정도가 적당

**(3) 수용 기준(DoD)을 명시한다**
- “정확히 무엇이 되면 통과인지”가 없으면 결과가 들쭉날쭉해진다.

**(4) 불확실성 처리 규칙**
- “모르면 질문” 대신:
  - `모호하면 합리적 가정 1~3개를 명시하고 진행` 또는
  - `불확실 항목은 별도 섹션(OPEN QUESTIONS)로 정리`

**(5) 중복 방지용 ‘금지 구역’을 만든다**
- 예: “이미 있는 파일 구조는 유지. 새 디렉토리 만들지 말 것.”

---

### 2.3 ⚠️ message 도구 사용 금지 규칙

서브에이전트 작업 지시문에 다음을 명시한다.

- **금지**: `message` 도구 사용(외부 전송/채널 메시징)
- **허용**: 로컬 파일 작성/수정, 리서치(검색/웹), 빌드/테스트, 로그 남기기
- **보고 방식**: 결과는 **파일로 저장**하고, 세션 종료 시 “어디에 무엇을 저장했는지”만 요약

**task에 넣을 문구 예시**
- “⚠️ message 도구 사용 금지. 결과는 지정 경로에 파일로 저장.”

---

## 3) 위임 템플릿

아래 템플릿은 그대로 복사해 task에 붙여 넣어도 된다.

### 3.1 코딩 작업 위임 템플릿

**Task 제목:** `[코딩] <기능/버그> 구현/수정`

**목적**
- <왜 필요한지 2~4줄>

**범위**
- 포함: <포함할 기능/파일/모듈>
- 제외: <하지 말 것>

**입력/컨텍스트**
- 리포지토리 위치: <경로>
- 관련 파일/모듈: <알고 있는 경로>
- 현재 동작/문제 재현: <재현 절차>

**해야 할 일**
1) 원인 파악(가능하면 로그/재현 기반)
2) 최소 변경으로 수정
3) 테스트 추가 또는 기존 테스트로 검증

**산출물(필수)**
- 변경 파일 목록
- 변경 요약(무엇을/왜)
- 실행/테스트 커맨드와 결과

**완료 기준(DoD)**
- 재현 케이스가 해결됨
- 테스트 통과(또는 실패 시 원인/다음 액션 제시)

**제약**
- ⚠️ message 도구 사용 금지
- 기존 코드 스타일/린트 규칙 준수

---

### 3.2 분석/리서치 위임 템플릿

**Task 제목:** `[리서치] <주제> 조사 및 결론 도출`

**목적**
- <결정해야 하는 것/의사결정 포인트>

**질문(명확히)**
- Q1: <예: 어떤 옵션이 우리 상황에 최적?>
- Q2: <예: 리스크/대안?>

**범위**
- 포함: 최근 자료, 공식 문서, 2차 출처는 보조
- 제외: 추측만으로 결론 내기

**산출물 포맷**
1) 결론(5줄)
2) 비교(표 또는 불릿): 옵션별 장단점/비용/리스크
3) 추천 시나리오(언제 A, 언제 B)
4) 출처 링크 5~10개
5) 불확실성/가정(있으면)

**완료 기준(DoD)**
- 출처가 명확
- 결론이 질문(Q1~Q2)에 직접 답함

**제약**
- ⚠️ message 도구 사용 금지

---

### 3.3 문서 작성 위임 템플릿

**Task 제목:** `[문서] <문서명> 초안 작성/개편`

**목적/독자**
- 독자: <예: 팀원/사용자/신규 온보딩>
- 목표: <읽고 무엇을 할 수 있어야?>

**범위**
- 포함: 용어 정의, 절차, 예시
- 제외: 불필요한 배경 서사, 중복 설명

**톤/형식**
- Markdown
- 섹션: 개요 → 절차 → 예시 → FAQ/트러블슈팅

**산출물(필수)**
- 파일 경로: <예: /.../DOC.md>
- 목차 포함
- 최소 1개 “정상 예시”, 1개 “실패 예시”

**완료 기준(DoD)**
- 독자가 추가 질문 없이 1회 수행 가능
- 링크/명령어/경로가 실제로 유효(가능하면 검증)

**제약**
- ⚠️ message 도구 사용 금지

---

### 3.4 테스트 작업 위임 템플릿

**Task 제목:** `[QA] <기능/버그> 검증 및 케이스 설계`

**목적**
- <무엇이 제대로 동작하는지 증명>

**입력**
- 대상 브랜치/커밋: <정보>
- 기대 동작(스펙): <불릿>

**해야 할 일**
1) 테스트 케이스 설계(정상/경계/오류)
2) 재현 절차 문서화
3) 실행 및 결과 기록

**산출물(필수)**
- 테스트 케이스 목록(표 또는 체크리스트)
- 실행 로그/스크린샷 경로
- 실패 시: 재현 단계 + 추정 원인 + 우선순위

**완료 기준(DoD)**
- 최소 정상 3개 + 경계 2개 + 오류 2개 케이스
- 결과가 재현 가능하게 기록됨

**제약**
- ⚠️ message 도구 사용 금지

---

## 4) 결과 취합 패턴

### 4.1 sessions_history로 결과 확인

권장 절차:

1) **세션 목록 확인**: 어떤 서브에이전트가 무엇을 했는지 제목/시간으로 스캔
2) **산출물 경로 확인**: “어디에 저장했는지”를 먼저 확인
3) **핵심 결과만 추출**: 결론/변경점/리스크/미해결 이슈
4) **교차 검증**: (가능하면) 다른 서브에이전트 결과 또는 직접 실행으로 확인

> 팁: 회수 단계에서 가장 흔한 실패는 “결과는 말로만 있고 파일이 없음”이다. task에 파일 경로를 박아 두면 방지된다.

---

### 4.2 품질 검증 체크리스트 (디렉터용)

아래 체크리스트로 결과를 ‘빠르게’ 판정한다.

**공통**
- [ ] 산출물이 요청한 포맷/경로로 존재한다
- [ ] 결론/요약이 10줄 이내로 먼저 나온다(탐색 비용 최소화)
- [ ] 가정/불확실성이 분리되어 있다(OPEN QUESTIONS)
- [ ] 다음 행동(Next steps)이 명확하다

**코딩 결과**
- [ ] 변경 범위가 과도하지 않다(필요 최소)
- [ ] 빌드/테스트 커맨드와 결과가 있다
- [ ] 에러/예외 케이스를 고려했다
- [ ] 롤백 가능(변경 이유/영향 범위 설명)

**리서치 결과**
- [ ] 출처 링크가 충분하고(5~10개) 신뢰도 구분이 있다(공식/2차)
- [ ] 비교가 의사결정 질문에 직접 연결된다
- [ ] 반례/리스크가 포함된다(단점 숨기지 않기)

**문서 결과**
- [ ] 독자가 1회 실행 가능한 절차 수준이다
- [ ] 예시가 있다(성공/실패)
- [ ] 용어 정의/전제조건이 명확하다

**테스트 결과**
- [ ] 재현 절차가 단계별로 명확하다
- [ ] 로그/스크린샷 등 증거가 있다
- [ ] 실패 시 우선순위/영향 범위가 포함된다

---

## 5) 디렉터 운영 팁 (짧은 규칙)

- “하나의 task = 하나의 산출물 책임”으로 자른다.
- 병렬 스폰 시에는 **역할을 겹치지 않게**(리서치 담당/코딩 담당/검증 담당).
- 최종 통합은 디렉터가 한다. 서브에이전트에게 “최종 결론”까지 맡기되, **승인/배포는 디렉터가**.

---

## 부록) task 작성 미니 체크리스트

- [ ] 목적(Why) 2~4줄
- [ ] 포함/제외 범위
- [ ] 입력(파일/링크/현재 상태)
- [ ] 산출물 형식/경로
- [ ] 완료 기준(DoD)
- [ ] ⚠️ message 도구 사용 금지 명시
